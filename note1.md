# 第一章

## 1.1

任务切换 与 真正的并发（硬件并发）

上下文切换：操作系统必须为当前运行的任务保存CPU的状态和指令指针，并计算出要切换到哪个任务，并为即将切换到的任务重新加载处理器状态。然后，CPU可能要将新任务的指令和数据的内存载入到缓存中，这会阻止CPU执行任何指令，从而造成的更多的延迟。

多进程并发与多线程并发的优缺点比较

+ 通信
+ 一致性
+ 开销
+ 远程

地址空间共享、缺少线程间的数据保护，多线程的开销远小于多进程。——一致性

并行与并发：并行更注重性能，使用硬件提升数据处理速度会讨论程序并行性；如果关注点在任务分离或任务响应，会讨论程序的并发性。

## 1.2 为什么使用并发

两个原因：关注点分离和性能。

分离不同的功能区域。一个DVD程序有两个功能：一是插入光盘、读取数据、解码播放；一是用户输入的播放、暂停、退出这些按键操作。如果只有一个线程，那么就需要在前面功能的代码中定期检查用户输入，这对前一个功能是功能无关的代码。——这是基于概念的设计，线程数不依赖CPU核心数。

性能：两种方式，一是将一个任务分为可以并行的子任务；而是将大量数据划分，在不同数据块上执行相同的操作。

不用并发——收益比不上成本。开销有：

+ 启动线程的固有开销
+ OS分配内核资源和堆栈空间
+ 线程资源有限(4GB内存，每个线程1MB堆栈空间，最多4096个线程)（可以用线程池限制线程数量）
+ 上下文切换，线程越多，切换频繁，用于执行的时间就少了

## 1.3 并发和多线程

## 1.4 开始入门

每个线程都必须有一个初始函数。新线程启动后，初始线程继续执行，如果不等待新线程结束，它运行到main()结束就结束程序了。

